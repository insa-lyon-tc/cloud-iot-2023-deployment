apiVersion: batch/v1
kind: Job
metadata:
  name: mongo-init
  namespace: mongo
spec:
  template:
    spec:
      containers:
        - name: mongo-init-container
          image: mongo:{{ mongo_version }}
          command: ["bash", "-c"]
          args:
            - |
              mongo mongo-0.mongo:{{ mongo_port }} --eval "printjson(rs.initiate({_id: 'rs0', members: [{_id: 0, host: 'mongo-0.mongo:{{ mongo_port }}'}, {_id: 1, host: 'mongo-1.mongo:{{ mongo_port }}'}, {_id: 2, host: 'mongo-2.mongo:{{ mongo_port }}'}]}))"
      restartPolicy: Never
